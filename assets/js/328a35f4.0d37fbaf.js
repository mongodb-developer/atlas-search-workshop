"use strict";(self.webpackChunkatlas_search_workshop=self.webpackChunkatlas_search_workshop||[]).push([[674],{4137:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(n),h=o,m=u["".concat(l,".").concat(h)]||u[h]||d[h]||a;return n?r.createElement(m,i(i({ref:t},p),{},{components:n})):r.createElement(m,i({ref:t},p))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:o,i[1]=s;for(var c=2;c<a;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},3238:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var r=n(7462),o=(n(7294),n(4137)),a=n(9524);const i={},s="3. \ud83d\udcbb Code",l={unversionedId:"end-to-end-lab/code",id:"end-to-end-lab/code",title:"3. \ud83d\udcbb Code",description:"Now is the moment of truth, where $search integrates into our book application, and becomes truly usable. Having a",source:"@site/docs/end-to-end-lab/3-code.mdx",sourceDirName:"end-to-end-lab",slug:"/end-to-end-lab/code",permalink:"/atlas-search-workshop/docs/end-to-end-lab/code",draft:!1,editUrl:"https://github.com/mongodb-developer/atlas-search-workshop/blob/main/docs/end-to-end-lab/3-code.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"2. \ud83d\udd0d $search",permalink:"/atlas-search-workshop/docs/end-to-end-lab/search"},next:{title:"\u2699\ufe0f Index Configuration",permalink:"/atlas-search-workshop/docs/category/\ufe0f-index-configuration"}},c={},p=[{value:"2. Service end-point in action",id:"2-service-end-point-in-action",level:2}],u={toc:p},d="wrapper";function h(e){let{components:t,...n}=e;return(0,o.kt)(d,(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"3--code"},"3. \ud83d\udcbb Code"),(0,o.kt)("p",null,"Now is the moment of truth, where ",(0,o.kt)("inlineCode",{parentName:"p"},"$search")," integrates into our book application, and becomes truly ",(0,o.kt)("em",{parentName:"p"},"usable"),". Having a\nworking application that we can iterate on is the best way to proceed with our Atlas Search learning journey. It's your\ndata. It's your app. It's your ",(0,o.kt)("inlineCode",{parentName:"p"},"$search")," pipeline. When it's all working we feel confident and can now safely make changes\nand see the effect of those changes through the experiences of our users."),(0,o.kt)("p",null,"Just like in the previous two sections, let's go, 1..., 2..., 3!"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Implement ",(0,o.kt)("inlineCode",{parentName:"li"},"/books/search?q=<query>")," search service")),(0,o.kt)("p",null,"Paste code into the search service stub, parameterizing the ",(0,o.kt)("inlineCode",{parentName:"p"},"query"),"."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"Service endpoint implementation"),(0,o.kt)("div",null,(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"server/src/controllers/books.ts#searchBooks"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"    public async searchBooks(query: string, limit: number = 10, skip: number = 0): Promise<Book[]> {\n        if (limit > 100) limit = 100;\n\n        const searchPipeline = [\n            {\n                '$search': {\n                  'index': 'default', \n                  'phrase': {\n                    'query': query, \n                    'path': [\n                      'title'\n                    ]\n                  }\n                }\n              },\n            { $skip: skip },\n            { $limit: limit }\n        ];\n\n        const booksAgg = collections?.books?.aggregate<Book>(searchPipeline);\n        const books = await booksAgg.toArray();\n        return books;   \n    }\n")))),(0,o.kt)("h2",{id:"2-service-end-point-in-action"},"2. Service end-point in action"),(0,o.kt)("p",null,"Got JSON? ",(0,o.kt)("a",{parentName:"p",href:"http://localhost:5000/books/search?q=tao"},"http://localhost:5000/books/search?q=tao")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Search UI")),(0,o.kt)("p",null,"Seeing ideally ",(0,o.kt)("em",{parentName:"p"},"relevant")," book covers, as we type, is a nice way to experience the benefits of Atlas Search. With this\nstraightforward baseline, using the defaults, we now have a multitude of ways to adjust "),(0,o.kt)("img",{alt:"End result of $search integration into our book app",src:(0,a.Z)("/img/end-to-end-lab/app-search-ui.png")}),(0,o.kt)("p",null,"\u2705 Search as you type in the ",(0,o.kt)("a",{parentName:"p",href:"http://localhost:4200/catalogue"},"Books Catalogue")," works?"))}h.isMDXComponent=!0}}]);